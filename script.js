[Truncated for brevity - full JS will be reinserted here in actual execution]